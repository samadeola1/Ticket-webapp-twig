{# templates/page/login.html.twig #}
{% extends 'base.html.twig' %}

{% block body %}
<div class="min-h-screen flex flex-col justify-center items-center -mt-20 px-6">
  <div id="login-form-container" class="w-full max-w-md bg-white shadow-lg rounded-xl p-8">
    <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Welcome Back</h2>
    <form id="login-form" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
        <input name="email" type="email" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your email" required />
        <p id="error-email" class="text-red-500 text-sm mt-1 hidden"></p>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
        <input name="password" type="password" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your password" required />
        <p id="error-password" class="text-red-500 text-sm mt-1 hidden"></p>
      </div>
      <button type="submit" class="w-full py-3 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition font-semibold">
        Login
      </button>
    </form>
    <p class="text-center text-sm text-gray-600 mt-4">
      Don't have an account?
      <a href="{{ path('app_signup') }}" class="text-indigo-600 font-medium hover:underline">Sign up</a>
    </p>
  </div>
</div>
{% endblock %}
{# templates/page/login.html.twig #}
...
{% endblock %}

{% block javascripts %}
    {{ parent() }} {# Includes base.html.twig's scripts #}
    <script type="module">
        import { getUserSession, login } from '{{ asset('js/auth.js') }}';
        import { showToast } from '{{ asset('js/toast.js') }}';

        // Redirect if already logged in
        if (getUserSession()) {
            window.location.href = '{{ path('app_dashboard') }}';
        }

        const loginForm = document.getElementById('login-form');
        const emailError = document.getElementById('error-email');
        const passwordError = document.getElementById('error-password');
        const formContainer = document.getElementById('login-form-container');

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            // Clear old errors
            emailError.classList.add('hidden');
            passwordError.classList.add('hidden');

            const email = loginForm.email.value;
            const password = loginForm.password.value;
            let valid = true;

            if (!email) {
                emailError.textContent = 'Email is required';
                emailError.classList.remove('hidden');
                valid = false;
            } else if (!/\S+@\S+\.\S+/.test(email)) {
                emailError.textContent = 'Email address is invalid';
                emailError.classList.remove('hidden');
                valid = false;
            }

            if (!password) {
                passwordError.textContent = 'Password is required';
                passwordError.classList.remove('hidden');
                valid = false;
            }

            if (!valid) return;

            const result = login(email, password);

            if (result.success) {
                showToast('âœ… Login successful!', 'success');
                window.location.href = '{{ path('app_dashboard') }}';
            } else {
                passwordError.textContent = result.error || 'Invalid email or password';
                passwordError.classList.remove('hidden');
                // Shake animation
                formContainer.classList.add('animate-shake');
                setTimeout(() => formContainer.classList.remove('animate-shake'), 400);
            }
        });
    </script>
{% endblock %}